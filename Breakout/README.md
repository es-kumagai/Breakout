# Breakout Game

macOS向けのクラシックなブロック崩しゲームの実装です。

## 仕様

* 開発環境：Xcode 15.0以上
* 言語：Swift 6.0
* フレームワーク：SwiftUI
* 非同期処理：Swift Concurrency
* 対応OS：macOS 14以上
* ウィンドウサイズ：800x600ピクセル

## ゲーム要素

1. パドル：
   * 幅100ピクセル、高さ15ピクセル、白色
   * マウス/タッチパッドで水平移動操作
   * 左右矢印キーでも操作可能
   * 楕円形ボールがブロックを崩すたびに幅が1ピクセルずつ縮小（最小で元のサイズの半分まで）
2. ボール：
   * 直径15ピクセル、形状ごとに異なるパステルカラー
     - 星型：黄色のパステル（ブロックごとにコンボカウント増加）
     - 円形：水色のパステル（ブロック衝突で徐々に成長）
     - 楕円形：オレンジ色のパステル（ブロック衝突でパドルを縮小）
   * 物理演算に基づいた移動と反射
   * パドルとの衝突位置によって反射角度が変化
   * 星型と楕円形のボールは移動中に回転
   * 画面下部に落下したボールは自動的に復活
   * ボール同士も衝突して跳ね返る
3. ブロック：
   * 5行10列で配置
   * 行ごとに異なる和風の色
     - 桜色（さくらいろ）- 淡いピンク色
     - 山吹色（やまぶきいろ）- 明るい黄色
     - 浅葱色（あさぎいろ）- 明るい青緑色
     - 萌黄色（もえぎいろ）- 鮮やかな黄緑色
     - 空色（そらいろ）- 明るい青色
   * 10秒ごとに上部に新しい行が自動追加（出現アニメーション付き）
   * 既存のブロックは下方向に移動（移動アニメーション付き）
4. ゲームロジック：
   * 初期ライフ3回
   * ブロック破壊：10点
   * スターコンボによるブロック破壊：20点（ボーナス加算）
   * レベルクリア（全ブロック破壊）：100点ボーナス
   * ボールを落とすとライフ減少
   * ライフ0でゲームオーバー
   * 全ブロック破壊で次レベル（ブロック再配置）
   * ブロックが画面下端に到達するとゲームオーバー
   * レーザーがパドルにヒットすると一時的にゲームがフリーズ
5. ビジュアルエフェクト：
   * ボールとレーザーの残像表示
     - 星型・楕円形ボールは本体の70%サイズで表示
     - 円形ボールは成長に合わせて残像サイズも拡大（本体の90%サイズ）
     - 透明度0.1〜0.3の範囲で設定
   * パドル衝突エフェクト
   * ブロック破壊エフェクト
   * レベルアップ演出
   * スターコンボ達成時の特殊エフェクト（1.5秒間表示）
   * レーザー衝突時の画面フラッシュ
   * すべてのエフェクトにパーティクル効果とブレンドモードを使用
6. 特殊機能：
   * 星型ボールのコンボシステム
     - ブロックに当たるごとにコンボカウント増加
     - 7回のヒットでコンボ達成（同じ色のブロックを一掃）
     - コンボカウントリセット条件：パドルに当たった時、画面外に出た時、ゲームリセット時
   * 楕円形ボールの縮小機能
     - ブロックに当たるごとにパドルの幅が1ピクセルずつ縮小
     - 最小で元のサイズの半分まで縮小
     - パドルサイズリセット条件：楕円ボールが画面外に出た時、全ボール落下時、レベルアップ時、ゲームリセット時
   * 複数ボール同時プレイ
     - 3つの異なる形状のボールがプレイ可能
     - ボール同士も衝突して跳ね返る
   * レーザー射出機能（ブロック破壊時に下向きに発射）

## アーキテクチャ

* MVVMパターン
* GameStateクラス（ObservableObject）でゲーム状態管理
* ContentViewとGameViewでUI構築
* 60FPSでのゲームループ実装（Timer.publishとCombine使用）

## ゲームの操作方法

* マウス/トラックパッド：パドルを移動
* 左右矢印キー：パドルを移動
* クリック：ゲーム開始とボール発射
* スペースキー：ゲーム開始、ボール発射、ゲームオーバー時にリスタート

## パフォーマンス最適化

* フレームレート非依存のアニメーション実装
* GPU描画の活用（drawingGroup修飾子）
* メモリ使用量の最適化
  - 配列操作の効率化（removeAll(keepingCapacity: true)）
  - キャパシティの予約（reserveCapacity）
  - 定数の効率的な定義
* 条件付きレンダリングによる描画負荷軽減
* キャッシュヒントの最適化（cacheHint修飾子）
* 残像エフェクトの最適化（処理量と視覚効果のバランス）
* .blendMode修飾子の効率的な利用
* エフェクト描画の最適化（パーティクル数と品質の調整）

## アクセシビリティ対応

* キーボードナビゲーションのサポート
* 適切なコントラスト比の確保
* VoiceOverサポート（accessibilityLabel, accessibilityHint）
* スケール効果とアニメーションの調整
* 視覚的フィードバックの強化

## 今後の拡張予定

* サウンドエフェクト追加
* 追加のパワーアップアイテム
* オンラインスコアボード
* ユーザー設定（難易度調整、アクセシビリティオプション）

## ビルド方法

1. Xcodeでプロジェクトを開く
2. ビルドターゲットを「My Mac」に設定
3. Command+R キーでビルド実行

## トラブルシューティング

* 画面が表示されない場合：macOS 14以上であることを確認してください
* パフォーマンスが低下する場合：他のアプリケーションを閉じてリソースを確保してください
* クラッシュする場合：最新のXcodeと最新のOS更新が適用されていることを確認してください
* ビジュアルエフェクトが表示されない場合：グラフィックドライバを最新バージョンに更新してください
* キーボード操作が効かない場合：フォーカスが正しくアプリに当たっていることを確認してください

## 技術情報

* 物理演算：カスタム実装の2D物理エンジン
* 衝突検出：形状ベースの最適化されたアルゴリズム
* レンダリング：SwiftUIとMetal（drawingGroup経由）
* パフォーマンス目標：60FPS以上（推奨環境）
* メモリ使用：約100MB以下


